---
- name: Configure Nginx server with Docker and deploy 
  hosts: webservers
  become: yes
  tasks:
      - name: Update apt cache
      apt:
        update_cache: yes

      - name: Install Nginx
      apt:
        name: nginx
        state: present

      - name: Start and enable Nginx
      service:
        name: nginx
        state: started
        enabled: yes

      - name: Install Prometheus
      apt:
        name: prometheus
        state: present

      - name: Install Docker
      apt:
        name: docker.io
        state: present

      - name: Start Docker service
      service:
        name: docker
        state: started
        enabled: yes

      - name: Pull and run Docker container
      shell: |
        docker pull {{ docker_user }}/nginx-app:latest
        docker run -d -p 80:80 {{ docker_user }}/nginx-app:latest

      - name: Install Prometheus
      shell: |
        curl -LO https://github.com/prometheus/prometheus/releases/latest/download/prometheus-linux-amd64.tar.gz
        tar xvf prometheus-linux-amd64.tar.gz
        mv prometheus-linux-amd64 /usr/local/bin/prometheus
      
      